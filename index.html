<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AXIS — Assistant de Coparentalité</title>
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#0B1220" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      html,body{height:100%;background:#0b1220;color:#e6edf6}
      .card{background:#0f1a2b;border:1px solid #1f2a44}
      .muted{color:#a9b4c7}
    </style>
  </head>

  <body class="min-h-screen flex items-start justify-center p-4">
    <div id="root" class="w-full max-w-2xl"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function App() {
        const [message, setMessage] = useState("");
        const [intent, setIntent] = useState("");
        const [tone, setTone] = useState("Apaisé");
        const [suggestion, setSuggestion] = useState("");
        const [status, setStatus] = useState("Apaisé");

        async function onPropose() {
          try {
const r = await fetch("/api/suggest", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ message, intent, tone })
});

            if (r.ok) {
              const data = await r.json();
              setSuggestion(data.suggestion || "Erreur ou clé OpenAI manquante");
              return;
            }
            setSuggestion("Erreur serveur");
          } catch (e) {
            setSuggestion("Impossible de contacter l'IA");
          }
        }

        useEffect(() => {
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
          }
        }, []);

        return (
          <main className="w-full">
            <header className="mb-4">
              <h1 className="text-2xl font-semibold">AXIS — Assistant de Coparentalité</h1>
              <p className="muted text-sm">Outil pour apaiser les échanges avec ton ex et préserver une communication respectueuse.</p>
            </header>

            <section className="card rounded-2xl p-4 space-y-4">
              <div className="text-lg font-medium">1. Gérer les échanges sensibles — EX</div>

              <label className="block text-sm muted">1. Message reçu</label>
              <textarea value={message} onChange={e=>setMessage(e.target.value)} rows="4"
                placeholder="Ex: 'Comme d'habitude tu t'y prends à la dernière minute…'"
                className="w-full rounded-xl bg-[#0b1424] border border-[#1f2a44] p-3 outline-none" />

              <label className="block text-sm muted">2. Ta réponse (ce que tu veux dire)</label>
              <textarea value={intent} onChange={e=>setIntent(e.target.value)} rows="3"
                placeholder="Ex: 'Je fais de mon mieux, on peut caler un horaire qui te convient ?'"
                className="w-full rounded-xl bg-[#0b1424] border border-[#1f2a44] p-3 outline-none" />

              <div className="flex flex-col sm:flex-row sm:items-center gap-3">
                <div className="flex items-center gap-2">
                  <span className="text-sm muted">Tonalité :</span>
                  <select value={tone} onChange={e=>setTone(e.target.value)} className="bg-[#0b1424] border border-[#1f2a44] rounded-lg p-2">
                    <option>Apaisé</option>
                    <option>Neutre</option>
                    <option>Fermeté bienveillante</option>
                  </select>
                </div>
                <div className="flex-1"></div>
                <button onClick={onPropose}
                  className="bg-amber-500 hover:bg-amber-400 text-black font-semibold px-4 py-2 rounded-xl">
                  Proposer une réponse
                </button>
                <button onClick={()=>{setMessage('');setIntent('');setSuggestion('');}}
                  className="border border-[#1f2a44] px-4 py-2 rounded-xl">Effacer</button>
              </div>

              <label className="block text-sm muted">3. Suggestion de l'IA</label>
              <textarea value={suggestion} readOnly rows="4"
                className="w-full rounded-xl bg-[#0b1424] border border-[#1f2a44] p-3 outline-none" />

              <div className="text-center text-sm muted border-t border-[#1f2a44] pt-3">{status}</div>
            </section>

            <footer className="mt-4 text-xs muted">
              Connecté à l’IA OpenAI — aucune donnée stockée.
            </footer>
          </main>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
